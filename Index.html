                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                    <h4 style="color: var(--accent); margin-bottom: 0.5rem;">üì± Alternative: Use CORS Proxy (if running locally)</h4>
                    <p style="color: var(--text-secondary); font-size: 0.875rem;">
                        If you're running this HTML file locally, you might need to:
                    </p>
                    <ul style="color: var(--text-secondary); font-size: 0.875rem; margin-left: 1rem;">
                        <li>1. Host this HTML on GitHub Pages or Netlify (free)</li>
                        <li>2. Or use a local web server (Python: python -m http.server)</li>
                        <li>3. Or deploy the HTML to any web hosting</li>
                    </ul>
                </div><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowBoard - Premium Task Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Dark mode glass morphism */
            --bg-primary: #0f172a;
            --bg-secondary: rgba(30, 41, 59, 0.8);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-bg-hover: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            --glass-blur: blur(10px);
            
            /* Text colors */
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            
            /* Status colors */
            --accent: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --hold: #8b5cf6;
            --review: #06b6d4;
            --grey: #64748b;
            
            /* Card colors */
            --card-bg: rgba(255, 255, 255, 0.03);
            --card-bg-hover: rgba(255, 255, 255, 0.06);
            --header-bg: rgba(15, 23, 42, 0.8);
            
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.light-mode {
            --bg-primary: #f8fafc;
            --bg-secondary: rgba(255, 255, 255, 0.8);
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-bg-hover: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(226, 232, 240, 0.8);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            
            --card-bg: rgba(255, 255, 255, 0.6);
            --card-bg-hover: rgba(255, 255, 255, 0.8);
            --header-bg: rgba(248, 250, 252, 0.9);
            
            --accent: #2563eb;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --hold: #7c3aed;
            --review: #0891b2;
            --grey: #6b7280;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            min-height: 100vh;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            transition: var(--transition);
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0.1;
            z-index: -2;
        }

        body.light-mode::before {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            opacity: 0.3;
        }

        /* Background image overlay */
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }

        body.light-mode .background-overlay {
            opacity: 0.2;
        }

        /* Premium glass header */
        .header {
            background: var(--header-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            padding: 1.5rem 2rem;
            box-shadow: var(--glass-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--glass-border);
            border-radius: 0 0 20px 20px;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: var(--text-primary);
        }

        .app-title-input {
            background: transparent;
            border: none;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            outline: none;
            cursor: text;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            transition: var(--transition);
            min-width: 200px;
        }

        .app-title-input:hover {
            background: var(--glass-bg);
        }

        .app-title-input:focus {
            background: var(--glass-bg-hover);
            box-shadow: 0 0 0 2px var(--accent);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1rem;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-radius: 12px;
            font-size: 0.875rem;
            border: 1px solid var(--glass-border);
            height: 44px;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--warning);
            animation: pulse 2s infinite;
        }

        .sync-status.connected .sync-indicator {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.5;
                transform: scale(1.1);
            }
        }

        .theme-toggle {
            width: 60px;
            height: 32px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-radius: 20px;
            position: relative;
            cursor: pointer;
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            display: flex;
            align-items: center;
            padding: 0 4px;
        }

        .theme-toggle::after {
            content: 'üåô';
            position: absolute;
            left: 6px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        body.light-mode .theme-toggle {
            background: var(--glass-bg);
        }

        body.light-mode .theme-toggle::after {
            content: '‚òÄÔ∏è';
            left: calc(100% - 30px);
        }

        .glass-btn {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: var(--glass-shadow);
            height: 44px;
        }

        .glass-btn:hover {
            background: var(--glass-bg-hover);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.2);
        }

        .add-task-btn {
            background: linear-gradient(135deg, var(--accent), var(--review));
            color: white;
            border: none;
        }

        .add-task-btn:hover {
            background: linear-gradient(135deg, var(--accent), var(--review));
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.4);
            color: white !important;
        }

        body.light-mode .add-task-btn {
            background: linear-gradient(135deg, var(--accent), var(--review));
            color: white;
        }

        body.light-mode .add-task-btn:hover {
            background: linear-gradient(135deg, #1d4ed8, #0891b2);
            color: white !important;
        }

        /* Image upload button */
        .image-upload-label {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
            padding: 0.75rem 1rem;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            height: 44px;
        }

        .image-upload-label:hover {
            background: var(--glass-bg-hover);
            transform: translateY(-2px);
        }

        #imageUpload {
            display: none;
        }

        /* Board Layout - Independent column heights */
        .board {
            padding: 2rem;
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            min-height: calc(100vh - 100px);
            align-items: flex-start;
        }

        /* Column Styles with glass morphism */
        .column {
            flex: 0 0 300px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.25rem;
            min-height: 200px;
            max-height: calc(100vh - 150px);
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: var(--glass-shadow);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .column:hover {
            background: var(--glass-bg-hover);
            transform: translateY(-2px);
        }

        /* Special column tints */
        .column.blocked {
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.1), 
                rgba(239, 68, 68, 0.05));
            border-color: rgba(239, 68, 68, 0.3);
        }

        .column.blocked:hover {
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.15), 
                rgba(239, 68, 68, 0.08));
        }

        .column.discarded {
            background: linear-gradient(135deg, 
                rgba(100, 116, 139, 0.1), 
                rgba(100, 116, 139, 0.05));
            border-color: rgba(100, 116, 139, 0.3);
        }

        .column.discarded:hover {
            background: linear-gradient(135deg, 
                rgba(100, 116, 139, 0.15), 
                rgba(100, 116, 139, 0.08));
        }

        /* Custom scrollbar for columns */
        .column::-webkit-scrollbar {
            width: 6px;
        }

        .column::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .column::-webkit-scrollbar-thumb {
            background: var(--glass-border);
            border-radius: 10px;
        }

        .column::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
            padding: 0.75rem;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            position: sticky;
            top: 0;
            backdrop-filter: var(--glass-blur);
            z-index: 10;
        }

        .column-title {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
        }

        .column-count {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.6rem;
            border-radius: 10px;
            font-size: 0.875rem;
            font-weight: 600;
            min-width: 28px;
            text-align: center;
        }

        /* Column specific count colors */
        .column.blocked .column-count { background: var(--danger); }
        .column.done .column-count { background: var(--success); }
        .column.in-progress .column-count { background: var(--accent); }
        .column.on-hold .column-count { background: var(--hold); }
        .column.in-review .column-count { background: var(--review); }
        .column.discarded .column-count { background: var(--grey); }

        /* Task Cards with glass effect */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            flex-grow: 1;
        }

        .task-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem;
            cursor: grab;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        body.light-mode .task-card {
            background: rgba(255, 255, 255, 0.95);
        }

        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), var(--review));
            opacity: 0.5;
            transition: var(--transition);
        }

        .task-card:hover {
            background: var(--card-bg-hover);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .task-card:hover::before {
            opacity: 1;
        }

        .task-card.dragging {
            opacity: 0.4;
            cursor: grabbing;
            transform: rotate(3deg);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .task-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .task-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .task-dates {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            background: var(--glass-bg);
            border-radius: 8px;
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .date-row {
            display: flex;
            justify-content: space-between;
        }

        .date-label {
            font-weight: 600;
            color: var(--accent);
        }

        .task-tat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0.5rem;
            padding: 0.4rem 0.6rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(6, 182, 212, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            font-size: 0.75rem;
            color: var(--text-primary);
        }

        .task-tat-label {
            font-weight: 600;
            color: var(--accent);
        }

        .task-tat-value {
            font-weight: 500;
        }

        .task-tat.overdue {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border-color: rgba(239, 68, 68, 0.3);
        }

        .task-tat.overdue .task-tat-label {
            color: var(--danger);
        }

        .task-priority {
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.625rem;
        }

        .priority-high {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .priority-medium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .priority-low {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        /* Blocker Note with glass effect */
        .blocker-note {
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
        }

        .blocker-label {
            font-size: 0.75rem;
            color: var(--danger);
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .blocker-input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 0.875rem;
            resize: none;
            outline: none;
            font-family: inherit;
            min-height: 40px;
        }

        /* Drag Over Effect */
        .column.drag-over {
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.15), 
                rgba(59, 130, 246, 0.1));
            border-color: var(--accent);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.2);
        }

        /* Modal with glass effect */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            animation: slideUp 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            background: var(--glass-bg-hover);
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group select option {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--review));
            color: white;
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff6b81);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .board {
                padding: 1.5rem;
            }
            
            .column {
                flex: 0 0 280px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
                border-radius: 0;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .app-title-input {
                font-size: 1.5rem;
            }
            
            .header-controls {
                width: 100%;
                justify-content: center;
            }
            
            .board {
                padding: 1rem;
                gap: 1rem;
            }
            
            .column {
                flex: 0 0 260px;
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .board {
                flex-direction: column;
                align-items: stretch;
            }
            
            .column {
                flex: 1 1 auto;
                max-height: none;
                margin-bottom: 1rem;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .glass-btn, .image-upload-label {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Background Overlay -->
    <div class="background-overlay" id="backgroundOverlay"></div>

    <!-- Header -->
    <header class="header">
        <input type="text" class="app-title-input" id="appTitle" value="FlowBoard" placeholder="Enter board name..." />
        <div class="header-controls">
            <div class="sync-status" id="syncStatus">
                <div class="sync-indicator"></div>
                <span>Not Connected</span>
            </div>
            <button class="glass-btn" id="connectBtn" onclick="openSheetsModal()">
                üìä Connect
            </button>
            <button class="disconnect-btn" id="disconnectBtn" onclick="disconnectSheets()" style="display: none;">
                ‚ùå Disconnect
            </button>
            <button class="glass-btn" id="refreshBtn" onclick="forceRefresh()" style="display: none;" title="Force refresh from sheet">
                üîÑ Refresh
            </button>
            <button class="open-sheet-btn" id="openSheetBtn" onclick="openConnectedSheet()" style="display: none;">
                üìÑ Open Sheet
            </button>
            <label for="imageUpload" class="image-upload-label">
                üñºÔ∏è Upload BG
            </label>
            <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)">
            <div class="theme-toggle" onclick="toggleTheme()"></div>
            <button class="glass-btn add-task-btn" onclick="openTaskModal()">+ Add Task</button>
        </div>
    </header>

    <!-- Kanban Board -->
    <div class="board" id="board">
        <!-- Columns will be generated here -->
    </div>

    <!-- Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <h2 class="modal-header">Create New Task</h2>
            <form id="taskForm">
                <div class="form-group">
                    <label for="taskTitle">Title</label>
                    <input type="text" id="taskTitle" required placeholder="Enter task title">
                </div>
                <div class="form-group">
                    <label for="taskDescription">Description</label>
                    <textarea id="taskDescription" rows="3" placeholder="Enter task description"></textarea>
                </div>
                <div class="form-group">
                    <label for="taskDeadlineDate">Proposed Deadline Date</label>
                    <input type="date" id="taskDeadlineDate" required>
                </div>
                <div class="form-group">
                    <label for="taskDeadlineTime">Proposed Deadline Time</label>
                    <input type="time" id="taskDeadlineTime" required>
                </div>
                <div class="form-group">
                    <label for="taskPriority">Priority</label>
                    <select id="taskPriority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskAssignee">Assignee</label>
                    <input type="text" id="taskAssignee" placeholder="Enter assignee name">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Google Sheets Setup Modal -->
    <div class="modal" id="sheetsModal">
        <div class="modal-content">
            <h2 class="modal-header">üìä Google Sheets Integration</h2>
            <div style="background: var(--glass-bg); border: 1px solid var(--accent); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent); margin-bottom: 1rem;">Setup Instructions:</h3>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">1. Create a Google Sheet with these columns:</p>
                <p style="margin-left: 1rem; font-family: monospace; background: var(--card-bg); padding: 0.5rem; border-radius: 6px;">
                    ID | Title | Description | Status | Priority | Assignee | Proposed Deadline | Created Date | Created Time | Modified Date | Modified Time | Actual TAT | Completed Date | Blocker Note
                </p>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">2. Go to Extensions ‚Üí Apps Script</p>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">3. Delete ALL existing code and paste this EXACT script:</p>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">4. Click üíæ Save (Ctrl+S)</p>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">5. Click "Deploy" ‚Üí "New Deployment"</p>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">6. Settings:</p>
                <ul style="margin-left: 2rem; color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">
                    <li>Type: Choose "Web app"</li>
                    <li>Description: "Kanban CRM Sync" (or any name)</li>
                    <li>Execute as: <strong>Me</strong></li>
                    <li>Who has access: <strong>Anyone</strong></li>
                </ul>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">7. Click "Deploy" ‚Üí Authorize if prompted</p>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">8. Copy the Web App URL (looks like: https://script.google.com/macros/s/...../exec)</p>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">9. IMPORTANT: Make sure the URL ends with <strong>/exec</strong> not /dev</p>
                
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                    <h4 style="color: var(--danger); margin-bottom: 0.5rem;">‚ö†Ô∏è Common Issues & Solutions:</h4>
                    <ul style="color: var(--text-secondary); font-size: 0.875rem; margin-left: 1rem;">
                        <li>‚úÖ URL must end with <strong>/exec</strong> (not /dev)</li>
                        <li>‚úÖ Must click "Anyone" for access (not "Anyone with link")</li>
                        <li>‚úÖ If you update the script, click "Deploy" ‚Üí "Manage Deployments" ‚Üí "Edit" ‚Üí Version: "New Version"</li>
                        <li>‚úÖ First row of sheet MUST have column headers</li>
                        <li>‚úÖ Test by adding just a Title in row 2, wait 3 seconds</li>
                    </ul>
                </div>
                
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <input type="text" id="sheetsUrl" placeholder="Paste your Web App URL ending with /exec" style="flex: 1; padding: 0.75rem; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text-primary);" />
                    <button class="btn btn-primary" onclick="connectSheets()">Connect</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>Apps Script Code (Copy this to your Google Sheet):</label>
                <textarea rows="20" readonly style="font-family: monospace; font-size: 0.8rem; background: var(--card-bg); padding: 1rem; border-radius: 8px;">
// IMPORTANT: Copy this ENTIRE script to your Google Apps Script

function doGet(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    
    // Initialize headers if sheet is empty
    if (sheet.getLastRow() === 0) {
      const headers = ['ID', 'Title', 'Description', 'Status', 'Priority', 'Assignee', 
                       'Proposed Deadline', 'Created Date', 'Created Time', 'Modified Date', 
                       'Modified Time', 'Actual TAT', 'Completed Date', 'Blocker Note'];
      sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
    }
    
    const data = sheet.getDataRange().getValues();
    const headers = data[0];
    const tasks = [];
    
    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      const task = {};
      headers.forEach((header, index) => {
        task[header] = row[index] || '';
      });
      tasks.push(task);
    }
    
    // Return with CORS headers for local HTML files
    return ContentService.createTextOutput(JSON.stringify(tasks))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader('Access-Control-Allow-Origin', '*')
      .setHeader('Access-Control-Allow-Methods', 'GET, POST')
      .setHeader('Access-Control-Allow-Headers', 'Content-Type');
  } catch(error) {
    return ContentService.createTextOutput(JSON.stringify({error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader('Access-Control-Allow-Origin', '*');
  }
}

function doPost(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    
    // Parse the data - handle both JSON and text content types
    let data;
    try {
      data = JSON.parse(e.postData.contents);
    } catch(parseError) {
      // If JSON parse fails, try to parse as text
      data = JSON.parse(e.postData.getDataAsString());
    }
    
    // Initialize headers if sheet is empty
    let headers = [];
    if (sheet.getLastRow() === 0) {
      headers = ['ID', 'Title', 'Description', 'Status', 'Priority', 'Assignee', 
                 'Proposed Deadline', 'Created Date', 'Created Time', 'Modified Date', 
                 'Modified Time', 'Actual TAT', 'Completed Date', 'Blocker Note'];
      sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
    } else {
      headers = sheet.getRange(1, 1, 1, sheet.getLastColumn() || 14).getValues()[0];
    }
    
    if (data.action === 'update') {
      // Find and update existing task
      const idColumn = headers.indexOf('ID');
      if (idColumn === -1) {
        throw new Error('ID column not found');
      }
      
      const values = sheet.getDataRange().getValues();
      let found = false;
      
      for (let i = 1; i < values.length; i++) {
        if (String(values[i][idColumn]) === String(data.task.ID)) {
          headers.forEach((header, index) => {
            if (data.task.hasOwnProperty(header)) {
              sheet.getRange(i + 1, index + 1).setValue(data.task[header] || '');
            }
          });
          found = true;
          break;
        }
      }
      
      if (!found) {
        // If task not found, create it
        const newRow = [];
        headers.forEach(header => {
          newRow.push(data.task[header] || '');
        });
        sheet.appendRow(newRow);
      }
    } else if (data.action === 'create') {
      // Add new task
      const newRow = [];
      headers.forEach(header => {
        newRow.push(data.task[header] || '');
      });
      sheet.appendRow(newRow);
    }
    
    // Return success with CORS headers
    return ContentService.createTextOutput('Success')
      .setMimeType(ContentService.MimeType.TEXT)
      .setHeader('Access-Control-Allow-Origin', '*')
      .setHeader('Access-Control-Allow-Methods', 'GET, POST')
      .setHeader('Access-Control-Allow-Headers', 'Content-Type');
  } catch(error) {
    return ContentService.createTextOutput(JSON.stringify({error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader('Access-Control-Allow-Origin', '*');
  }
}

// Test function - Run this to check if script is working
function testSetup() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  
  // Initialize headers if needed
  if (sheet.getLastRow() === 0) {
    const headers = ['ID', 'Title', 'Description', 'Status', 'Priority', 'Assignee', 
                     'Proposed Deadline', 'Created Date', 'Created Time', 'Modified Date', 
                     'Modified Time', 'Actual TAT', 'Completed Date', 'Blocker Note'];
    sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  }
  
  // Add a test task
  sheet.appendRow([999, 'Test Task', 'This is a test', 'To Do', 'High', 'Test User', 
                   '', '2024-01-01', '12:00 PM', '', '', '', '', '']);
  
  Logger.log('Test completed! Check your sheet for a test task.');
  return 'Setup is working!';
}
                </textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeSheetsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Blocker Modal -->
    <div class="modal" id="blockerModal">
        <div class="modal-content">
            <h2 class="modal-header">‚ö†Ô∏è Task Blocked</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                This task has been moved to blocked status. Please provide a reason:
            </p>
            <div class="form-group">
                <label for="blockerReason">Blocker Reason *</label>
                <textarea id="blockerReason" rows="4" placeholder="Explain why this task is blocked..." required></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="cancelBlocker()">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmBlocker()">Confirm Block</button>
            </div>
        </div>
    </div>

    <!-- TAT Input Modal -->
    <div class="modal" id="tatModal">
        <div class="modal-content">
            <h2 class="modal-header">‚úÖ Task Completed!</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                Great job! When was this task actually completed?
            </p>
            <div class="form-group">
                <label for="completionDate">Completion Date</label>
                <input type="date" id="completionDate" required>
            </div>
            <div class="form-group">
                <label for="completionTime">Completion Time</label>
                <input type="time" id="completionTime" required>
            </div>
            <div class="form-group">
                <label for="tatNotes">Additional Notes (Optional)</label>
                <textarea id="tatNotes" rows="3" placeholder="Any notes about the completion..."></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="skipTAT()">Use Current Time</button>
                <button type="button" class="btn btn-primary" onclick="submitTAT()">Submit</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="help-modal-content">
            <h2 class="modal-header">üìö Help & Instructions</h2>
            
            <div class="help-tabs">
                <div class="help-tab active" onclick="switchHelpTab('basics')">Basics</div>
                <div class="help-tab" onclick="switchHelpTab('sheets')">Google Sheets</div>
                <div class="help-tab" onclick="switchHelpTab('hosting')">Hosting</div>
                <div class="help-tab" onclick="switchHelpTab('shortcuts')">Shortcuts</div>
            </div>

            <!-- Basics Tab -->
            <div class="help-content active" id="basics-help">
                <div class="help-section">
                    <h3>üéØ Getting Started</h3>
                    <p>Welcome to FlowBoard! This is a powerful task management system with Google Sheets integration.</p>
                    <ul>
                        <li>Create tasks with the <strong>+ Add Task</strong> button</li>
                        <li>Drag and drop tasks between columns</li>
                        <li>Tasks automatically sync with Google Sheets</li>
                        <li>All data is saved locally until you connect sheets</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üìã Column Types</h3>
                    <ul>
                        <li><strong>To Do</strong> - New tasks start here</li>
                        <li><strong>In Progress</strong> - Tasks being worked on</li>
                        <li><strong>In Review</strong> - Tasks pending review</li>
                        <li><strong>Done</strong> - Completed tasks (triggers confetti!)</li>
                        <li><strong>On Hold</strong> - Paused tasks</li>
                        <li><strong>Blocked</strong> - Tasks with blockers (requires reason)</li>
                        <li><strong>Discarded</strong> - Cancelled tasks</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>‚ú® Features</h3>
                    <ul>
                        <li><strong>Deadlines</strong> - Set date and time for task completion</li>
                        <li><strong>TAT Tracking</strong> - Automatically calculates turn-around time</li>
                        <li><strong>Priority Levels</strong> - High, Medium, Low</li>
                        <li><strong>Assignees</strong> - Assign tasks to team members</li>
                        <li><strong>Dark/Light Mode</strong> - Toggle with moon/sun icon</li>
                        <li><strong>Custom Background</strong> - Upload your own image</li>
                    </ul>
                </div>
            </div>

            <!-- Google Sheets Tab -->
            <div class="help-content" id="sheets-help">
                <div class="help-section">
                    <h3>üìä Sheet Setup</h3>
                    <p>1. Create a new Google Sheet with these column headers (copy exactly):</p>
                    <code style="display: block; margin: 1rem 0; padding: 1rem; background: var(--glass-bg); border-radius: 8px; font-size: 0.8rem; overflow-x: auto;">
ID | Title | Description | Status | Priority | Assignee | Proposed Deadline | Created Date | Created Time | Modified Date | Modified Time | Actual TAT | Completed Date | Blocker Note
                    </code>
                </div>

                <div class="help-section">
                    <h3>‚öôÔ∏è Apps Script Setup</h3>
                    <ul>
                        <li>Go to <strong>Extensions ‚Üí Apps Script</strong></li>
                        <li>Delete ALL existing code</li>
                        <li>Copy the script from the connection modal</li>
                        <li>Save (Ctrl+S)</li>
                        <li>Deploy ‚Üí New Deployment ‚Üí Web app</li>
                        <li>Execute as: <strong>Me</strong></li>
                        <li>Access: <strong>Anyone</strong></li>
                        <li>Copy the URL ending with <code>/exec</code></li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üîß Troubleshooting</h3>
                    <ul>
                        <li>URL must end with <code>/exec</code> not <code>/dev</code></li>
                        <li>Press F12 to check browser console for errors</li>
                        <li>Ensure first row has headers</li>
                        <li>Run <code>testSetup()</code> in Apps Script to test</li>
                        <li>Re-deploy after script changes</li>
                    </ul>
                </div>
            </div>

            <!-- Hosting Tab -->
            <div class="help-content" id="hosting-help">
                <div class="help-section">
                    <h3>üåê GitHub Pages (Recommended)</h3>
                    <ul>
                        <li>Create account at <strong>github.com</strong></li>
                        <li>Create new repository (public)</li>
                        <li>Upload this HTML as <code>index.html</code></li>
                        <li>Settings ‚Üí Pages ‚Üí Deploy from main</li>
                        <li>Access at: <code>username.github.io/repo-name</code></li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üöÄ Quick Alternatives</h3>
                    <ul>
                        <li><strong>Netlify Drop</strong> - Drag & drop at app.netlify.com/drop</li>
                        <li><strong>Vercel</strong> - Similar instant deployment</li>
                        <li><strong>Local Server</strong> - <code>python -m http.server 8000</code></li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>‚ö†Ô∏è Local File Issues</h3>
                    <p>Running from <code>file://</code> causes CORS errors. You must:</p>
                    <ul>
                        <li>Host online (GitHub Pages, Netlify)</li>
                        <li>Use local web server</li>
                        <li>Install CORS browser extension (temporary)</li>
                    </ul>
                </div>
            </div>

            <!-- Shortcuts Tab -->
            <div class="help-content" id="shortcuts-help">
                <div class="help-section">
                    <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
                    <div class="shortcut-grid">
                        <div class="shortcut-item">
                            <span class="shortcut-key">F12</span> - Browser Console
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Ctrl+S</span> - Save (in Apps Script)
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Ctrl+F5</span> - Hard Refresh
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Esc</span> - Close Modals
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3>üí° Pro Tips</h3>
                    <ul>
                        <li>Tasks sync every 3 seconds automatically</li>
                        <li>Just enter a Title to create a task quickly</li>
                        <li>Drag to Blocked requires a reason</li>
                        <li>Drag to Done asks for completion time</li>
                        <li>Click board title to rename it</li>
                        <li>Your preferences are saved locally</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üé® Customization</h3>
                    <ul>
                        <li>Upload background images for personalization</li>
                        <li>Toggle dark/light mode based on preference</li>
                        <li>Rename the board to match your project</li>
                        <li>All settings persist across sessions</li>
                    </ul>
                </div>
            </div>

            <div class="form-actions" style="margin-top: 2rem;">
                <button type="button" class="btn btn-primary" onclick="closeHelpModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Confetti Container -->
    <div class="confetti-container" id="confettiContainer"></div>

    <script>
        // Column configuration - Review before Done
        const columns = [
            { id: 'todo', title: 'To Do', icon: 'üìù' },
            { id: 'in-progress', title: 'In Progress', icon: '‚ö°' },
            { id: 'in-review', title: 'In Review', icon: 'üëÄ' },
            { id: 'done', title: 'Done', icon: '‚úÖ' },
            { id: 'on-hold', title: 'On Hold', icon: '‚è∏Ô∏è' },
            { id: 'blocked', title: 'Blocked', icon: 'üö´' },
            { id: 'discarded', title: 'Discarded', icon: 'üóëÔ∏è' }
        ];

        // Task data store
        let tasks = {
            'todo': [],
            'in-progress': [],
            'done': [],
            'on-hold': [],
            'blocked': [],
            'in-review': [],
            'discarded': []
        };

        let taskIdCounter = 1;
        let draggedElement = null;
        let draggedFrom = null;
        let pendingBlockedTask = null;
        let pendingDoneTask = null;
        let sheetsWebAppUrl = null;
        let sheetsUrl = null;
        let syncInterval = null;

        // Initialize board
        function initBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            
            columns.forEach(column => {
                const columnEl = createColumn(column);
                board.appendChild(columnEl);
            });
            
            // Load saved preferences
            loadPreferences();
            
            // Check for saved sheets URL
            const savedUrl = localStorage.getItem('sheetsWebAppUrl');
            const savedSheetUrl = localStorage.getItem('sheetsUrl');
            if (savedUrl) {
                sheetsWebAppUrl = savedUrl;
                if (savedSheetUrl) {
                    sheetsUrl = savedSheetUrl;
                }
                document.getElementById('connectBtn').style.display = 'none';
                document.getElementById('disconnectBtn').style.display = 'flex';
                document.getElementById('refreshBtn').style.display = 'flex';
                document.getElementById('openSheetBtn').style.display = 'flex';
                startSync();
            } else {
                // Load tasks from local storage if no sheets connected
                loadTasksFromLocalStorage();
            }
        }

        // Save tasks to local storage
        function saveTasksToLocalStorage() {
            if (!sheetsWebAppUrl) {
                // Only save to local storage if not connected to sheets
                localStorage.setItem('kanbanTasks', JSON.stringify(tasks));
                localStorage.setItem('taskIdCounter', taskIdCounter.toString());
            }
        }

        // Load tasks from local storage
        function loadTasksFromLocalStorage() {
            const savedTasks = localStorage.getItem('kanbanTasks');
            const savedCounter = localStorage.getItem('taskIdCounter');
            
            if (savedTasks) {
                try {
                    tasks = JSON.parse(savedTasks);
                    renderTasks();
                } catch (e) {
                    console.error('Failed to load saved tasks:', e);
                    loadSampleTasks();
                }
            } else {
                loadSampleTasks();
            }
            
            if (savedCounter) {
                taskIdCounter = parseInt(savedCounter);
            }
        }

        // Create column element
        function createColumn(column) {
            const columnEl = document.createElement('div');
            columnEl.className = `column ${column.id}`;
            columnEl.dataset.columnId = column.id;
            
            columnEl.innerHTML = `
                <div class="column-header">
                    <div class="column-title">
                        <span>${column.icon}</span>
                        <span>${column.title}</span>
                    </div>
                    <span class="column-count">0</span>
                </div>
                <div class="task-list" ondrop="handleDrop(event, '${column.id}')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                </div>
            `;
            
            return columnEl;
        }

        // Format date and time
        function formatDateTime(date) {
            const d = new Date(date);
            const dateStr = d.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
            const timeStr = d.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            return { date: dateStr, time: timeStr };
        }

        // Format deadline
        function formatDeadline(deadline) {
            if (!deadline) return null;
            const d = new Date(deadline);
            const now = new Date();
            const diffMs = d - now;
            const diffDays = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
            
            const dateStr = d.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
            
            return {
                dateStr,
                diffDays,
                overdue: diffMs < 0
            };
        }

        // Create task card
        function createTaskCard(task, columnId) {
            const card = document.createElement('div');
            card.className = 'task-card';
            card.draggable = true;
            card.dataset.taskId = task.id;
            card.dataset.columnId = columnId;
            
            card.ondragstart = (e) => handleDragStart(e, task, columnId);
            card.ondragend = handleDragEnd;
            
            // Format dates
            const created = formatDateTime(task.createdAt);
            const modified = task.modifiedAt ? formatDateTime(task.modifiedAt) : null;
            
            // Format deadline
            const deadline = task.deadline ? formatDeadline(task.deadline) : null;
            
            let dateHtml = `
                <div class="task-dates">
                    <div class="date-row">
                        <span class="date-label">Created:</span>
                        <span>${created.date} ${created.time}</span>
                    </div>
            `;
            
            if (modified && task.modifiedAt !== task.createdAt) {
                dateHtml += `
                    <div class="date-row">
                        <span class="date-label">Modified:</span>
                        <span>${modified.date} ${modified.time}</span>
                    </div>
                `;
            }
            
            dateHtml += '</div>';
            
            // Deadline display
            let deadlineHtml = '';
            if (deadline) {
                const deadlineClass = deadline.overdue ? 'overdue' : '';
                const daysText = deadline.overdue ? 
                    `Overdue by ${Math.abs(deadline.diffDays)} days` : 
                    `Due in ${deadline.diffDays} days`;
                
                deadlineHtml = `
                    <div class="task-deadline ${deadlineClass}">
                        <span class="task-deadline-label">üìÖ Deadline:</span>
                        <span class="task-deadline-value">${deadline.dateStr} (${daysText})</span>
                    </div>
                `;
            }
            
            let blockerHtml = '';
            if (columnId === 'blocked' && task.blockerNote) {
                blockerHtml = `
                    <div class="blocker-note">
                        <div class="blocker-label">üö´ Blocker Reason:</div>
                        <textarea class="blocker-input" placeholder="Describe the blocker..." 
                            onblur="updateBlockerNote(${task.id}, this.value)">${task.blockerNote}</textarea>
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="task-title">${task.title}</div>
                ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                ${dateHtml}
                ${blockerHtml}
                ${deadlineHtml}
                <div class="task-meta">
                    <span class="task-priority priority-${task.priority || 'medium'}">${task.priority || 'medium'}</span>
                    <span class="task-assignee">${task.assignee || 'Unassigned'}</span>
                </div>
            `;
            
            return card;
        }

        // Add task to column with automatic sheet sync
        function addTaskToColumn(task, columnId) {
            if (!tasks[columnId]) tasks[columnId] = [];
            tasks[columnId].push(task);
            renderTasks();
            saveTasksToLocalStorage();
            
            // Automatically sync to sheets if connected
            if (sheetsWebAppUrl) {
                syncToSheets(task, 'create');
            }
        }

        // Render all tasks
        function renderTasks() {
            columns.forEach(column => {
                const taskList = document.querySelector(`.column.${column.id} .task-list`);
                const countEl = document.querySelector(`.column.${column.id} .column-count`);
                
                if (taskList && countEl) {
                    taskList.innerHTML = '';
                    const columnTasks = tasks[column.id] || [];
                    
                    columnTasks.forEach(task => {
                        taskList.appendChild(createTaskCard(task, column.id));
                    });
                    
                    countEl.textContent = columnTasks.length;
                }
            });
        }

        // Drag and drop handlers
        function handleDragStart(e, task, columnId) {
            draggedElement = e.target;
            draggedFrom = columnId;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.innerHTML);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
            draggedFrom = null;
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            
            const column = e.currentTarget.closest('.column');
            if (column) {
                column.classList.add('drag-over');
            }
            
            return false;
        }

        function handleDragLeave(e) {
            const column = e.currentTarget.closest('.column');
            if (column) {
                column.classList.remove('drag-over');
            }
        }

        function handleDrop(e, toColumnId) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            const column = e.currentTarget.closest('.column');
            if (column) {
                column.classList.remove('drag-over');
            }
            
            if (draggedElement && draggedFrom !== toColumnId) {
                const taskId = parseInt(draggedElement.dataset.taskId);
                
                // If moving to blocked, show blocker modal
                if (toColumnId === 'blocked') {
                    const task = findTask(taskId);
                    if (!task.blockerNote) {
                        pendingBlockedTask = { taskId, fromColumn: draggedFrom, toColumn: toColumnId };
                        openBlockerModal();
                        return;
                    }
                }
                
                // If moving to done, show TAT modal
                if (toColumnId === 'done' && draggedFrom !== 'done') {
                    pendingDoneTask = { taskId, fromColumn: draggedFrom };
                    openTATModal();
                    return;
                }
                
                moveTask(taskId, draggedFrom, toColumnId);
            }
            
            return false;
        }

        // TAT modal functions
        function openTATModal() {
            document.getElementById('tatModal').classList.add('active');
            // Set current date and time as default
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const timeStr = now.toTimeString().slice(0, 5);
            document.getElementById('completionDate').value = dateStr;
            document.getElementById('completionTime').value = timeStr;
        }

        function skipTAT() {
            if (pendingDoneTask) {
                const task = findTask(pendingDoneTask.taskId);
                if (task) {
                    task.completedDate = new Date().toISOString();
                    // Calculate TAT based on creation and completion
                    const created = new Date(task.createdAt);
                    const completed = new Date();
                    const diffMs = completed - created;
                    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                    const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    task.actualTAT = `${diffDays}d ${diffHours}h`;
                }
                moveTask(pendingDoneTask.taskId, pendingDoneTask.fromColumn, 'done');
                triggerConfetti();
            }
            document.getElementById('tatModal').classList.remove('active');
            pendingDoneTask = null;
        }

        function submitTAT() {
            if (pendingDoneTask) {
                const completionDate = document.getElementById('completionDate').value;
                const completionTime = document.getElementById('completionTime').value;
                const notes = document.getElementById('tatNotes').value;
                
                // Combine date and time
                let completionDateTime;
                if (completionDate && completionTime) {
                    completionDateTime = `${completionDate}T${completionTime}`;
                } else if (completionDate) {
                    completionDateTime = `${completionDate}T23:59`;
                } else {
                    completionDateTime = new Date().toISOString();
                }
                
                const task = findTask(pendingDoneTask.taskId);
                if (task) {
                    task.completedDate = new Date(completionDateTime).toISOString();
                    
                    // Calculate TAT based on creation and specified completion
                    const created = new Date(task.createdAt);
                    const completed = new Date(completionDateTime);
                    const diffMs = completed - created;
                    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                    const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    task.actualTAT = `${diffDays}d ${diffHours}h`;
                    
                    if (notes) {
                        task.completionNotes = notes;
                    }
                }
                
                moveTask(pendingDoneTask.taskId, pendingDoneTask.fromColumn, 'done');
                triggerConfetti();
            }
            document.getElementById('tatModal').classList.remove('active');
            document.getElementById('tatNotes').value = '';
            pendingDoneTask = null;
        }

        // Blocker modal functions
        function openBlockerModal() {
            document.getElementById('blockerModal').classList.add('active');
            document.getElementById('blockerReason').focus();
        }

        function cancelBlocker() {
            document.getElementById('blockerModal').classList.remove('active');
            document.getElementById('blockerReason').value = '';
            pendingBlockedTask = null;
            renderTasks();
        }

        function confirmBlocker() {
            const reason = document.getElementById('blockerReason').value.trim();
            if (!reason) {
                alert('Please provide a reason for blocking this task');
                return;
            }
            
            if (pendingBlockedTask) {
                const task = findTask(pendingBlockedTask.taskId);
                if (task) {
                    task.blockerNote = reason;
                    moveTask(pendingBlockedTask.taskId, pendingBlockedTask.fromColumn, pendingBlockedTask.toColumn);
                }
            }
            
            document.getElementById('blockerModal').classList.remove('active');
            document.getElementById('blockerReason').value = '';
            pendingBlockedTask = null;
        }

        // Move task between columns
        function moveTask(taskId, fromColumn, toColumn) {
            const taskIndex = tasks[fromColumn].findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                const task = tasks[fromColumn].splice(taskIndex, 1)[0];
                
                // Update modified date
                task.modifiedAt = new Date().toISOString();
                
                // Remove blocker note if moving from blocked
                if (fromColumn === 'blocked' && toColumn !== 'blocked') {
                    delete task.blockerNote;
                }
                
                task.status = toColumn;
                tasks[toColumn].push(task);
                renderTasks();
                saveTasksToLocalStorage();
                
                // Sync to sheets if connected
                if (sheetsWebAppUrl) {
                    syncToSheets(task, 'update');
                }
            }
        }

        // Update blocker note
        function updateBlockerNote(taskId, note) {
            const task = findTask(taskId);
            if (task) {
                task.blockerNote = note;
                task.modifiedAt = new Date().toISOString();
                saveTasksToLocalStorage();
                if (sheetsWebAppUrl) {
                    syncToSheets(task, 'update');
                }
            }
        }

        // Find task by ID
        function findTask(taskId) {
            for (const columnId in tasks) {
                const task = tasks[columnId].find(t => t.id === taskId);
                if (task) return task;
            }
            return null;
        }

        // Handle image upload
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageUrl = e.target.result;
                    document.getElementById('backgroundOverlay').style.backgroundImage = `url(${imageUrl})`;
                    localStorage.setItem('backgroundImage', imageUrl);
                };
                reader.readAsDataURL(file);
            }
        }

        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
        }

        // Save and load preferences
        function saveAppTitle() {
            const title = document.getElementById('appTitle').value || 'FlowBoard';
            localStorage.setItem('appTitle', title);
            document.title = title + ' - Premium Task Manager';
        }

        function loadPreferences() {
            // Load theme
            const theme = localStorage.getItem('theme');
            if (theme === 'light') {
                document.body.classList.add('light-mode');
            }
            
            // Load app title
            const savedTitle = localStorage.getItem('appTitle');
            if (savedTitle) {
                document.getElementById('appTitle').value = savedTitle;
                document.title = savedTitle + ' - Premium Task Manager';
            }
            
            // Load background image
            const savedBg = localStorage.getItem('backgroundImage');
            if (savedBg) {
                document.getElementById('backgroundOverlay').style.backgroundImage = `url(${savedBg})`;
            }
        }

        // Google Sheets Integration
        function openSheetsModal() {
            document.getElementById('sheetsModal').classList.add('active');
        }

        function closeSheetsModal() {
            document.getElementById('sheetsModal').classList.remove('active');
        }

        function connectSheets() {
            const url = document.getElementById('sheetsUrl').value.trim();
            if (!url) {
                alert('Please enter a valid Google Sheets Web App URL');
                return;
            }
            
            sheetsWebAppUrl = url;
            localStorage.setItem('sheetsWebAppUrl', url);
            
            // Show connected state
            document.getElementById('connectBtn').style.display = 'none';
            document.getElementById('disconnectBtn').style.display = 'flex';
            document.getElementById('openSheetBtn').style.display = 'flex';
            
            startSync();
            closeSheetsModal();
        }

        function disconnectSheets() {
            if (confirm('Are you sure you want to disconnect from Google Sheets? Your tasks will be saved locally.')) {
                // Save current tasks to local storage before disconnecting
                saveTasksToLocalStorage();
                
                sheetsWebAppUrl = null;
                sheetsUrl = null;
                localStorage.removeItem('sheetsWebAppUrl');
                localStorage.removeItem('sheetsUrl');
                
                // Update UI
                document.getElementById('connectBtn').style.display = 'flex';
                document.getElementById('disconnectBtn').style.display = 'none';
                document.getElementById('openSheetBtn').style.display = 'none';
                
                // Update sync status
                const syncStatus = document.getElementById('syncStatus');
                syncStatus.classList.remove('connected');
                syncStatus.querySelector('span').textContent = 'Not Connected';
                
                // Clear sync interval
                if (syncInterval) {
                    clearInterval(syncInterval);
                    syncInterval = null;
                }
            }
        }

        function openConnectedSheet() {
            if (sheetsUrl) {
                window.open(sheetsUrl, '_blank');
            } else {
                // Prompt user to enter their sheet URL
                const url = prompt('Please enter your Google Sheet URL (the actual spreadsheet, not the script URL):');
                if (url) {
                    sheetsUrl = url;
                    localStorage.setItem('sheetsUrl', url);
                    window.open(url, '_blank');
                }
            }
        }

        function startSync() {
            if (!sheetsWebAppUrl) return;
            
            // Update sync status
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.classList.add('connected');
            syncStatus.querySelector('span').textContent = 'Connected';
            
            // Show refresh button
            document.getElementById('refreshBtn').style.display = 'flex';
            
            // Initial sync
            syncFromSheets();
            
            // Set up periodic sync (every 5 seconds instead of 3 for stability)
            if (syncInterval) clearInterval(syncInterval);
            syncInterval = setInterval(() => {
                console.log('‚è∞ Auto-sync triggered');
                syncFromSheets();
            }, 5000);
        }

        // Force refresh function
        function forceRefresh() {
            console.log('üîÑ Force refresh triggered');
            const btn = document.getElementById('refreshBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥';
            
            syncFromSheets().then(() => {
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'üîÑ Refresh';
                }, 1000);
            });
        }

        async function syncFromSheets() {
            if (!sheetsWebAppUrl) return;
            
            try {
                console.log('üîÑ Starting sync from sheets...');
                // Add cache buster to prevent caching
                const url = sheetsWebAppUrl + '?t=' + Date.now() + '&cache=no';
                console.log('üì° Fetching from:', url);
                
                // Try different fetch approach for better compatibility
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-store',
                    credentials: 'omit',
                    headers: {
                        'Accept': 'application/json,text/plain,*/*',
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache'
                    }
                });
                
                console.log('üìä Response status:', response.status);
                
                if (!response.ok) {
                    console.error('‚ùå Response not OK:', response.status, response.statusText);
                    return;
                }
                
                const text = await response.text();
                console.log('üìù Response length:', text.length);
                console.log('üìù First 200 chars:', text.substring(0, 200));
                
                let data;
                try {
                    data = JSON.parse(text);
                    console.log('‚úÖ Parsed JSON successfully, rows:', data.length);
                } catch (parseError) {
                    console.error('‚ùå Failed to parse JSON:', parseError);
                    console.log('Response text:', text);
                    return;
                }
                
                if (data.error) {
                    console.error('‚ùå Sheet error:', data.error);
                    alert('Sheet Error: ' + data.error + '\n\nPlease check:\n1. Script is deployed correctly\n2. URL ends with /exec\n3. Access is set to "Anyone"');
                    return;
                }
                
                // Store current task IDs to avoid duplicates
                const existingIds = new Set();
                Object.values(tasks).forEach(columnTasks => {
                    columnTasks.forEach(task => existingIds.add(task.id));
                });
                
                // Clear existing tasks for fresh sync
                Object.keys(tasks).forEach(key => tasks[key] = []);
                
                // Load tasks from sheets
                let taskCount = 0;
                let skippedCount = 0;
                
                data.forEach((row, index) => {
                    // Skip empty rows
                    if (!row || typeof row !== 'object') {
                        skippedCount++;
                        return;
                    }
                    
                    // Log first few rows for debugging
                    if (index < 3) {
                        console.log(`Row ${index}:`, row);
                    }
                    
                    // Check if Title exists and is not empty
                    if (row.Title && row.Title.toString().trim() !== '') {
                        taskCount++;
                        
                        // Parse status - handle variations
                        let status = 'todo';
                        if (row.Status) {
                            status = row.Status.toString().toLowerCase()
                                .replace(/\s+/g, '-')
                                .replace('to-do', 'todo');
                        }
                        
                        // Validate status
                        const validStatuses = ['todo', 'in-progress', 'in-review', 'done', 'on-hold', 'blocked', 'discarded'];
                        if (!validStatuses.includes(status)) {
                            console.log(`‚ö†Ô∏è Invalid status "${row.Status}" for task "${row.Title}", defaulting to "todo"`);
                            status = 'todo';
                        }
                        
                        const task = {
                            id: row.ID ? parseInt(row.ID) : taskIdCounter++,
                            title: row.Title.toString().trim(),
                            description: row.Description || '',
                            status: status,
                            priority: (row.Priority || 'medium').toLowerCase(),
                            assignee: row.Assignee || '',
                            deadline: row['Proposed Deadline'] || '',
                            createdAt: row['Created Date'] && row['Created Time'] ? 
                                new Date(`${row['Created Date']} ${row['Created Time']}`).toISOString() : new Date().toISOString(),
                            modifiedAt: row['Modified Date'] && row['Modified Time'] ? 
                                new Date(`${row['Modified Date']} ${row['Modified Time']}`).toISOString() : null,
                            actualTAT: row['Actual TAT'] || '',
                            completedDate: row['Completed Date'] || '',
                            blockerNote: row['Blocker Note'] || ''
                        };
                        
                        // Add to appropriate column
                        if (!tasks[task.status]) {
                            console.error(`‚ùå Invalid status: ${task.status}`);
                            tasks['todo'].push(task);
                        } else {
                            tasks[task.status].push(task);
                        }
                        
                        // Update ID counter
                        if (task.id >= taskIdCounter) {
                            taskIdCounter = task.id + 1;
                        }
                    } else if (row.ID || row.Description || row.Status) {
                        // Row has some data but no title
                        console.log(`‚ö†Ô∏è Skipping row ${index + 1} - missing Title:`, row);
                        skippedCount++;
                    }
                });
                
                console.log(`‚úÖ Sync complete: ${taskCount} tasks loaded, ${skippedCount} rows skipped`);
                console.log('üìä Task distribution:', Object.keys(tasks).map(k => `${k}: ${tasks[k].length}`).join(', '));
                
                renderTasks();
                
                // Don't save to local storage when syncing from sheets
                // as sheets is the source of truth when connected
                
            } catch (error) {
                console.error('‚ùå Sync error:', error);
                console.error('Stack:', error.stack);
                
                if (error.message.includes('Failed to fetch')) {
                    console.log('üîß Possible solutions:');
                    console.log('1. Check if URL ends with /exec (not /dev)');
                    console.log('2. Verify script is deployed with "Anyone" access');
                    console.log('3. Check browser console for CORS errors');
                    console.log('4. Try re-deploying the Apps Script');
                    
                    // Try alternative fetch method
                    console.log('üîÑ Trying alternative fetch method...');
                    tryAlternativeFetch();
                }
            }
        }

        // Alternative fetch method for troubleshooting
        async function tryAlternativeFetch() {
            if (!sheetsWebAppUrl) return;
            
            try {
                // Try with minimal options
                const response = await fetch(sheetsWebAppUrl + '?random=' + Math.random());
                const text = await response.text();
                console.log('üîÑ Alternative fetch successful, response:', text.substring(0, 100));
            } catch (err) {
                console.error('‚ùå Alternative fetch also failed:', err);
            }
        }

        // Manual sync function for debugging
        window.manualSync = async function() {
            console.log('üîß Manual sync triggered');
            await syncFromSheets();
        };

        async function syncToSheets(task, action) {
            if (!sheetsWebAppUrl) return;
            
            try {
                const created = formatDateTime(task.createdAt);
                const modified = task.modifiedAt ? formatDateTime(task.modifiedAt) : created;
                
                const sheetTask = {
                    ID: task.id,
                    Title: task.title,
                    Description: task.description || '',
                    Status: task.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()),
                    Priority: task.priority || 'medium',
                    Assignee: task.assignee || '',
                    'Proposed Deadline': task.deadline || '',
                    'Created Date': created.date,
                    'Created Time': created.time,
                    'Modified Date': modified.date,
                    'Modified Time': modified.time,
                    'Actual TAT': task.actualTAT || '',
                    'Completed Date': task.completedDate ? formatDateTime(task.completedDate).date + ' ' + formatDateTime(task.completedDate).time : '',
                    'Blocker Note': task.blockerNote || ''
                };
                
                console.log(`Syncing to sheets (${action}):`, task.title);
                
                const response = await fetch(sheetsWebAppUrl, {
                    method: 'POST',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({ action, task: sheetTask })
                });
                
                if (!response.ok) {
                    console.error('Sync failed:', response.status, response.statusText);
                    return;
                }
                
                const result = await response.text();
                console.log('Sync result:', result);
                
                // Trigger a refresh after successful write
                setTimeout(() => syncFromSheets(), 1000);
                
            } catch (error) {
                console.error('Failed to sync to sheets:', error);
                if (error.message.includes('Failed to fetch')) {
                    console.log('Could not sync. Check your connection and deployment.');
                }
            }
        }

        // Confetti effect
        function triggerConfetti() {
            const container = document.getElementById('confettiContainer');
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500', '#800080'];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    container.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 4000);
                }, i * 10);
            }
        }

        // Modal functions
        function openTaskModal() {
            document.getElementById('taskModal').classList.add('active');
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.remove('active');
            document.getElementById('taskForm').reset();
        }

        // Handle task form submission
        document.getElementById('taskForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const now = new Date().toISOString();
            
            // Combine date and time for deadline
            const deadlineDate = document.getElementById('taskDeadlineDate').value;
            const deadlineTime = document.getElementById('taskDeadlineTime').value;
            let deadline = '';
            if (deadlineDate && deadlineTime) {
                deadline = `${deadlineDate}T${deadlineTime}`;
            } else if (deadlineDate) {
                deadline = `${deadlineDate}T23:59`;
            }
            
            const task = {
                id: taskIdCounter++,
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                assignee: document.getElementById('taskAssignee').value,
                deadline: deadline,
                status: 'todo',
                createdAt: now,
                modifiedAt: now
            };
            
            addTaskToColumn(task, 'todo');
            closeTaskModal();
        });

        // Save title on change
        document.getElementById('appTitle').addEventListener('blur', saveAppTitle);

        // Load sample tasks
        function loadSampleTasks() {
            const now = new Date().toISOString();
            const sampleTasks = [
                { id: taskIdCounter++, title: 'Launch product website', description: 'Deploy the new marketing website with updated branding', priority: 'high', assignee: 'Alex Chen', createdAt: now, modifiedAt: now, status: 'todo' },
                { id: taskIdCounter++, title: 'Customer feedback analysis', description: 'Review Q4 customer surveys and create action items', priority: 'high', assignee: 'Sarah Johnson', createdAt: now, modifiedAt: now, status: 'todo' },
                { id: taskIdCounter++, title: 'API v2 development', description: 'Implement new endpoints for mobile app integration', priority: 'medium', assignee: 'Mike Williams', createdAt: now, modifiedAt: now, status: 'in-progress' },
                { id: taskIdCounter++, title: 'Security audit', description: 'Complete quarterly security assessment', priority: 'high', assignee: 'Alex Chen', createdAt: now, modifiedAt: now, status: 'in-progress' },
                { id: taskIdCounter++, title: 'Design system update', description: 'Refresh component library with new brand guidelines', priority: 'medium', assignee: 'Emma Davis', createdAt: now, modifiedAt: now, status: 'in-review' },
                { id: taskIdCounter++, title: 'Mobile app testing', description: 'QA for iOS and Android releases', priority: 'low', assignee: 'Mike Williams', createdAt: now, modifiedAt: now, status: 'on-hold' },
                { id: taskIdCounter++, title: 'Payment integration', description: 'Implement Stripe payment gateway', priority: 'medium', assignee: 'Sarah Johnson', createdAt: now, modifiedAt: now, status: 'blocked', blockerNote: 'Waiting for merchant account approval from finance team' },
                { id: taskIdCounter++, title: 'Q3 goals review', description: 'Team performance and goal achievement analysis', priority: 'low', assignee: 'Alex Chen', createdAt: now, modifiedAt: now, status: 'done' }
            ];
            
            // Distribute sample tasks
            sampleTasks.forEach(task => {
                const status = task.status.replace(' ', '-');
                if (!tasks[status]) tasks[status] = [];
                tasks[status].push(task);
            });
            
            renderTasks();
        }

        // Close modals on click outside
        window.onclick = (e) => {
            if (e.target === document.getElementById('taskModal')) {
                closeTaskModal();
            }
            if (e.target === document.getElementById('sheetsModal')) {
                closeSheetsModal();
            }
        };

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            initBoard();
        });
    </script>
</body>
</html>